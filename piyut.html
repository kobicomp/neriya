<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>注专转  拽转 砖</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #4f46e5 0%, #06b6d4 100%);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .header p {
            opacity: 0.9;
        }

        .main-content {
            display: flex;
            flex: 1;
            gap: 20px;
            padding: 20px;
        }

        .sidebar {
            width: 350px;
            background: #f8fafc;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            height: fit-content;
            max-height: calc(100vh - 200px);
            overflow-y: auto;
        }

        .hall-container {
            flex: 1;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            overflow: auto;
            position: relative;
        }

        .search-section {
            margin-bottom: 25px;
        }

        .search-section h3 {
            margin-bottom: 15px;
            color: #1f2937;
            font-size: 1.1rem;
        }

        .search-group {
            margin-bottom: 15px;
        }

        .search-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #374151;
            font-size: 0.9rem;
        }

        .search-group input,
        .search-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .search-group input:focus,
        .search-group select:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .stats {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stats h4 {
            margin-bottom: 10px;
            color: #1f2937;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .stat-label {
            color: #6b7280;
        }

        .stat-value {
            font-weight: 600;
            color: #1f2937;
        }

        .occupied { color: #dc2626; }
        .available { color: #059669; }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #4f46e5;
            color: white;
        }

        .btn-primary:hover {
            background: #4338ca;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .btn-danger {
            background: #dc2626;
            color: white;
        }

        .btn-danger:hover {
            background: #b91c1c;
        }

        .hall-map {
            direction: ltr;
            position: relative;
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 30px;
            min-height: 600px;
            overflow: auto;
        }

        .bimah {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 80px;
            background: #8b5cf6;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .seating-area {
            margin-top: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .row {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .row-label {
            width: 30px;
            height: 30px;
            background: #4f46e5;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
            margin-left: 15px;
        }

        .seat {
            width: 35px;
            height: 35px;
            border: 2px solid #d1d5db;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.3s ease;
            background: white;
            position: relative;
        }

        .seat:hover {
            transform: scale(1.1);
            z-index: 5;
        }

        .seat.available {
            background: #dcfce7;
            border-color: #16a34a;
            color: #15803d;
        }

        .seat.occupied {
            background: #fecaca;
            border-color: #dc2626;
            color: #b91c1c;
        }

        .seat.selected {
            background: #dbeafe;
            border-color: #2563eb;
            color: #1d4ed8;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.3);
        }

        .seat-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #1f2937;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 10;
            margin-bottom: 5px;
        }

        .seat:hover .seat-tooltip {
            opacity: 1;
        }

        .seat-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: #1f2937;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 12px;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .modal h3 {
            margin-bottom: 20px;
            color: #1f2937;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
        }

        .form-group input:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            font-size: 0.85rem;
        }

        .legend h4 {
            margin-bottom: 10px;
            color: #1f2937;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
            border: 1px solid #d1d5db;
        }

        @media (max-width: 1200px) {
            .main-content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                max-height: none;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5rem;
            }
            
            .hall-map {
                padding: 15px;
            }
            
            .seat {
                width: 30px;
                height: 30px;
                font-size: 0.7rem;
            }
            
            .modal-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1> 注专转  拽转 砖</h1>
            <p> 拽爪转 拽转 </p>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <div class="search-section">
                    <h3> 驻砖 </h3>
                    
                    <div class="search-group">
                        <label>驻砖 驻 砖</label>
                        <input type="text" id="searchName" placeholder="住 砖 驻砖...">
                    </div>
                    
                    <div class="search-group">
                        <label>驻砖 驻 拽</label>
                        <input type="text" id="searchSeat" placeholder="砖: -5">
                    </div>
                    
                    <div class="search-group">
                        <label>爪 拽</label>
                        <select id="filterStatus">
                            <option value=""></option>
                            <option value="available">驻</option>
                            <option value="occupied">转驻住</option>
                        </select>
                    </div>
                </div>

                <div class="stats">
                    <h4> 住住拽转</h4>
                    <div class="stat-item">
                        <span class="stat-label">住" 拽转:</span>
                        <span class="stat-value" id="totalSeats">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">拽转 转驻住:</span>
                        <span class="stat-value occupied" id="occupiedSeats">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">拽转 驻:</span>
                        <span class="stat-value available" id="availableSeats">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">转驻住:</span>
                        <span class="stat-value" id="occupancyRate">0%</span>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="loadFromExcel()"> 注 拽抓</button>
                    <button class="btn btn-secondary" onclick="clearAllSeats()"> 拽 </button>
                </div>

                <div id="searchResults"></div>
            </div>

            <div class="hall-container">
                <div class="legend">
                    <h4>拽专</h4>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #dcfce7; border-color: #16a34a;"></div>
                        <span>驻</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #fecaca; border-color: #dc2626;"></div>
                        <span>转驻住</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #dbeafe; border-color: #2563eb;"></div>
                        <span>专</span>
                    </div>
                </div>

                <div class="hall-map">
                    <div class="bimah"></div>
                    <div class="seating-area" id="seatingArea">
                        <!-- 拽转 爪专  转 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for seat assignment -->
    <div id="seatModal" class="modal">
        <div class="modal-content">
            <h3 id="modalTitle">拽爪转 拽</h3>
            <div class="form-group">
                <label>住驻专 拽</label>
                <input type="text" id="seatNumber" readonly>
            </div>
            <div class="form-group">
                <label>砖 </label>
                <input type="text" id="personName" placeholder="住 砖 ">
            </div>
            <div class="form-group">
                <label>驻 (驻爪)</label>
                <input type="text" id="personPhone" placeholder="住 住驻专 驻">
            </div>
            <div class="form-group">
                <label>注专转 (驻爪)</label>
                <input type="text" id="personNotes" placeholder="注专转 住驻转">
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeModal()"></button>
                <button class="btn btn-danger" id="removeBtn" onclick="removePerson()" style="display: none;">住专</button>
                <button class="btn btn-primary" id="assignBtn" onclick="assignSeat()">拽爪</button>
            </div>
        </div>
    </div>

    <script>
        // 转 拽转
        let seatsData = {};
        let selectedSeatId = null;

        // 专转  - 注 住住 驻 砖专转
        const hallLayout = {
            rows: [
                { label: '', seats: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20] },
                { label: '', seats: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20] },
                { label: '', seats: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20] },
                { label: '', seats: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20] },
                { label: '', seats: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20] },
                { label: '', seats: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20] },
                { label: '', seats: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20] },
                { label: '', seats: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20] },
                { label: '', seats: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20] },
                { label: '', seats: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20] },
                { label: '', seats: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20] },
                { label: '', seats: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20] }
            ]
        };

        // 转 注专转
        window.addEventListener('load', function() {
            createSeatingLayout();
            updateStats();
            setupEventListeners();
        });

        function setupEventListeners() {
            document.getElementById('searchName').addEventListener('input', performSearch);
            document.getElementById('searchSeat').addEventListener('input', performSearch);
            document.getElementById('filterStatus').addEventListener('change', performSearch);
        }

        function createSeatingLayout() {
            const seatingArea = document.getElementById('seatingArea');
            seatingArea.innerHTML = '';

            hallLayout.rows.forEach(row => {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'row';

                // 转转 砖专
                const rowLabel = document.createElement('div');
                rowLabel.className = 'row-label';
                rowLabel.textContent = row.label;
                rowDiv.appendChild(rowLabel);

                // 爪专转 住转
                row.seats.forEach(seatNum => {
                    const seatId = `${row.label}-${seatNum}`;
                    const seat = document.createElement('div');
                    seat.className = 'seat available';
                    seat.id = seatId;
                    seat.textContent = seatNum;
                    seat.onclick = () => selectSeat(seatId);

                    // tooltip
                    const tooltip = document.createElement('div');
                    tooltip.className = 'seat-tooltip';
                    tooltip.textContent = `拽 ${seatId} - 驻`;
                    seat.appendChild(tooltip);

                    rowDiv.appendChild(seat);

                    // 转 转 拽
                    seatsData[seatId] = {
                        id: seatId,
                        row: row.label,
                        number: seatNum,
                        occupied: false,
                        person: null
                    };
                });

                seatingArea.appendChild(rowDiv);
            });
        }

        function selectSeat(seatId) {
            //  专 拽转
            if (selectedSeatId) {
                document.getElementById(selectedSeatId).classList.remove('selected');
            }

            selectedSeatId = seatId;
            document.getElementById(seatId).classList.add('selected');
            
            openModal(seatId);
        }

        function openModal(seatId) {
            const seat = seatsData[seatId];
            const modal = document.getElementById('seatModal');
            
            document.getElementById('seatNumber').value = seatId;
            
            if (seat.occupied) {
                // 拽 转驻住 - 爪 注专
                document.getElementById('modalTitle').textContent = `注专转 拽 ${seatId}`;
                document.getElementById('personName').value = seat.person.name;
                document.getElementById('personPhone').value = seat.person.phone || '';
                document.getElementById('personNotes').value = seat.person.notes || '';
                document.getElementById('removeBtn').style.display = 'inline-block';
                document.getElementById('assignBtn').textContent = '注';
            } else {
                // 拽 驻 - 爪 拽爪 砖
                document.getElementById('modalTitle').textContent = `拽爪转 拽 ${seatId}`;
                document.getElementById('personName').value = '';
                document.getElementById('personPhone').value = '';
                document.getElementById('personNotes').value = '';
                document.getElementById('removeBtn').style.display = 'none';
                document.getElementById('assignBtn').textContent = '拽爪';
            }
            
            modal.style.display = 'block';
            document.getElementById('personName').focus();
        }

        function closeModal() {
            document.getElementById('seatModal').style.display = 'none';
            
            //  专
            if (selectedSeatId) {
                document.getElementById(selectedSeatId).classList.remove('selected');
                selectedSeatId = null;
            }
        }

        function assignSeat() {
            const seatId = document.getElementById('seatNumber').value;
            const name = document.getElementById('personName').value.trim();
            
            if (!name) {
                alert(' 住 砖');
                return;
            }
            
            const phone = document.getElementById('personPhone').value.trim();
            const notes = document.getElementById('personNotes').value.trim();
            
            // 注 转 拽
            seatsData[seatId].occupied = true;
            seatsData[seatId].person = {
                name: name,
                phone: phone,
                notes: notes
            };
            
            updateSeatDisplay(seatId);
            updateStats();
            closeModal();
        }

        function removePerson() {
            if (!selectedSeatId) return;
            
            if (confirm(' 转  砖专爪 住专 转  拽 ?')) {
                seatsData[selectedSeatId].occupied = false;
                seatsData[selectedSeatId].person = null;
                
                updateSeatDisplay(selectedSeatId);
                updateStats();
                closeModal();
            }
        }

        function updateSeatDisplay(seatId) {
            const seatElement = document.getElementById(seatId);
            const seat = seatsData[seatId];
            const tooltip = seatElement.querySelector('.seat-tooltip');
            
            if (seat.occupied) {
                seatElement.className = 'seat occupied';
                tooltip.textContent = `拽 ${seatId} - ${seat.person.name}`;
            } else {
                seatElement.className = 'seat available';
                tooltip.textContent = `拽 ${seatId} - 驻`;
            }
        }

        function updateStats() {
            const totalSeats = Object.keys(seatsData).length;
            const occupiedSeats = Object.values(seatsData).filter(seat => seat.occupied).length;
            const availableSeats = totalSeats - occupiedSeats;
            const occupancyRate = totalSeats > 0 ? Math.round((occupiedSeats / totalSeats) * 100) : 0;
            
            document.getElementById('totalSeats').textContent = totalSeats;
            document.getElementById('occupiedSeats').textContent = occupiedSeats;
            document.getElementById('availableSeats').textContent = availableSeats;
            document.getElementById('occupancyRate').textContent = occupancyRate + '%';
        }

        function performSearch() {
            const searchName = document.getElementById('searchName').value.toLowerCase();
            const searchSeat = document.getElementById('searchSeat').value.toLowerCase();
            const filterStatus = document.getElementById('filterStatus').value;
            
            const results = Object.values(seatsData).filter(seat => {
                const matchName = !searchName || (seat.person && seat.person.name.toLowerCase().includes(searchName));
                const matchSeat = !searchSeat || seat.id.toLowerCase().includes(searchSeat);
                const matchStatus = !filterStatus || 
                    (filterStatus === 'occupied' && seat.occupied) ||
                    (filterStatus === 'available' && !seat.occupied);
                
                return matchName && matchSeat && matchStatus;
            });
            
            displaySearchResults(results);
            highlightSeats(results);
        }

        function displaySearchResults(results) {
            const resultsDiv = document.getElementById('searchResults');
            
            if (results.length === 0) {
                resultsDiv.innerHTML = '';
                return;
            }
            
            let html = '<div style="margin-top: 20px;"><h4> 转爪转 驻砖:</h4>';
            
            results.forEach(seat => {
                const status = seat.occupied ? '转驻住' : '驻';
                const personInfo = seat.person ? ` - ${seat.person.name}` : '';
                const statusClass = seat.occupied ? 'occupied' : 'available';
                
                html += `
                    <div style="padding: 8px; margin: 5px 0; border-radius: 4px; background: white; border: 1px solid #e5e7eb; cursor: pointer;" 
                         onclick="selectSeat('${seat.id}')">
                        <strong>${seat.id}</strong> 
                        <span class="${statusClass}">(${status})</span>
                        ${personInfo}
                    </div>
                `;
            });
            
            html += '</div>';
            resultsDiv.innerHTML = html;
        }

        function highlightSeats(results) {
            // 驻住 砖转 拽转
            Object.keys(seatsData).forEach(seatId => {
                const element = document.getElementById(seatId);
                element.style.boxShadow = '';
                element.style.transform = '';
            });
            
            // 砖转 转爪转 驻砖
            results.forEach(seat => {
                const element = document.getElementById(seat.id);
                element.style.boxShadow = '0 0 0 3px rgba(245, 158, 11, 0.5)';
                element.style.transform = 'scale(1.05)';
            });
        }

        function clearAllSeats() {
            if (confirm(' 转  砖专爪 拽转 转  拽转?')) {
                Object.keys(seatsData).forEach(seatId => {
                    seatsData[seatId].occupied = false;
                    seatsData[seatId].person = null;
                    updateSeatDisplay(seatId);
                });
                
                updateStats();
                document.getElementById('searchResults').innerHTML = '';
            }
        }

        async function loadFromExcel() {
            try {
                const response = await fetch('1.xlsx');
                if (!response.ok) {
                    throw new Error(' 转 注 转 拽抓');
                }
                
                const arrayBuffer = await response.arrayBuffer();
                const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                const data = XLSX.utils.sheet_to_json(firstSheet);
                
                // 拽 拽转 拽
                Object.keys(seatsData).forEach(seatId => {
                    seatsData[seatId].occupied = false;
                    seatsData[seatId].person = null;
                });
                
                // 注 转 拽抓
                data.forEach(row => {
                    const seatId = row['拽'] || row['seat'] || '';
                    const name = row['砖'] || row['name'] || '';
                    const phone = row['驻'] || row['phone'] || '';
                    const notes = row['注专转'] || row['notes'] || '';
                    
                    if (seatId && name && seatsData[seatId]) {
                        seatsData[seatId].occupied = true;
                        seatsData[seatId].person = {
                            name: name,
                            phone: phone,
                            notes: notes
                        };
                        updateSeatDisplay(seatId);
                    }
                });
                
                updateStats();
                alert('转 注 爪 拽抓!');
                
            } catch (error) {
                console.error('Error loading Excel:', error);
                alert('砖 注转 拽抓: ' + error.message);
            }
        }

        // 住专转  爪 抓 转
        window.onclick = function(event) {
            const modal = document.getElementById('seatModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // 拽爪专 拽转
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
            }
        });
    </script>
</body>
</html>
