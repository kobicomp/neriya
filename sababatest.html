// הוספת אירוע לחיצה על כפתור הצגת/הסתרת אפשרויות ייצוא בלשונית סטטיסטיקה לפי מידות
            const toggleSizeExportBtn = document.getElementById('toggleSizeExportOptions');
            const sizeExportContainer = document.getElementById('sizeExportOptionsContainer');
            
            toggleSizeExportBtn.addEventListener('click', function() {
                if (sizeExportContainer.style.display === 'none') {
                    sizeExportContainer.style.display = 'block';
                    toggleSizeExportBtn.textContent = 'הסתר אפשרויות ייצוא';
                } else {
                    sizeExportContainer.style.display = 'none';
                    toggleSizeExportBtn.textContent = 'אפשרויות ייצוא';
                }
            });
            
            // הוספת אירוע לחיצה על כפתור הייצוא בלשונית רשימת הזמנות
            document.getElementById('exportCsvBtn').addEventListener('click', exportFilteredDataToCSV);
            
            // הוספת אירוע לחיצה על כפתור הייצוא בלשונית סטטיסטיקה לפי מידות
            document.getElementById('exportSizeCsvBtn').addEventListener('click', exportSizeDataToCSV);
        }

        // אתחול הדף
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                // הצגת הודעת טעינה ראשונית
                const loadingDiv = document.createElement('div');
                loadingDiv.id = 'loading-indicator';
                loadingDiv.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(255,255,255,0.8); display: flex; justify-content: center; align-items: center; z-index: 9999; font-size: 24px; font-weight: bold;';
                loadingDiv.innerHTML = '<div>טוען נתונים מגוגל שיטס...</div>';
                document.body.appendChild(loadingDiv);
                
                // אתחול הלשוניות
                initializeTabs();
                
                // אתחול אפשרויות הייצוא
                setupExportOptions();
                
                // טעינת ספריית PapaParse לפענוח קבצי CSV
                await loadScript('https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js');
                
                // טעינת הנתונים מגוגל שיטס
                await loadData();
                
                // הסרת הודעת הטעינה
                document.body.removeChild(loadingDiv);
                
                // הגדרת רענון אוטומטי כל 5 דקות
                setInterval(async () => {
                    try {
                        await loadData();
                        console.log('Data refreshed automatically');
                    } catch (error) {
                        console.error('Error refreshing data:', error);
                    }
                }, 5 * 60 * 1000); // 5 דקות
            } catch (error) {
                console.error('Error initializing dashboard:', error);
                
                const loadingDiv = document.getElementById('loading-indicator');
                if (loadingDiv) {
                    loadingDiv.innerHTML = '<div>אירעה שגיאה בטעינת הנתונים. אנא רענן את הדף ונסה שנית.</div>';
                } else {
                    alert('אירעה שגיאה בטעינת הדשבורד. אנא רענן את הדף ונסה שנית.');
                }
            }
        });
        
        // פונקציית עזר לטעינת סקריפטים חיצוניים
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }
    </script>
</body>
</html>
